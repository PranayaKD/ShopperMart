{% extends "base.html" %}
{% block title %}My Orders | ShopperMart{% endblock %}

{% block content %}
<div class="container py-4">
  <div style="text-align: center; margin-bottom: 3rem;">
    <div style="font-size: 3rem; margin-bottom: 0.5rem;">üì¶</div>
    <h1 style="font-size: 2rem; font-weight: 800;">My Orders</h1>
  </div>

  {% if orders %}
  <div style="display: flex; flex-direction: column; gap: 2rem; max-width: 800px; margin: 0 auto;">
    {% for order in orders %}
    <div class="card" style="padding: 0; overflow: hidden; border: 2px solid var(--border-color);">

      <!-- Order Header -->
      <div
        style="background: var(--surface-2); padding: 1rem 1.5rem; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color);">
        <div>
          <span style="font-weight: 700; color: var(--primary);">Order #{{ order.id }}</span>
          <div style="font-size: 0.85rem; color: var(--text-muted);">{{ order.created_at|date:"M d, Y" }}</div>
        </div>

        <div style="text-align: right;">
          <span style="font-weight: 700; font-size: 1.1rem;">‚Çπ{{ order.total }}</span>
          <div style="font-size: 0.8rem; font-weight: 600; color: var(--success);">
            {% if order.payment == 'cod' %}Cash on Delivery
            {% elif order.payment == 'card' %}Credit/Debit Card
            {% elif order.payment == 'upi' %}UPI
            {% else %}{{ order.payment|upper }}{% endif %}
          </div>
        </div>
      </div>

      <!-- Order Items -->
      <div style="padding: 1rem 1.5rem;">
        {% for item in order.items.all %}
        <div
          style="display: flex; justify-content: space-between; align-items: center; padding-block: 0.75rem; border-bottom: 1px solid var(--border-color);">
          <div style="display: flex; align-items: center; gap: 1rem;">
            {% if item.product.image %}
            <img src="{{ item.product.image.url }}"
              style="width: 50px; height: 50px; border-radius: var(--radius-sm); object-fit: cover;"
              alt="{{ item.product.name }}">
            {% else %}
            <div
              style="background: var(--surface-3); width: 50px; height: 50px; border-radius: var(--radius-sm); display: flex; align-items: center; justify-content: center; font-size: 1.2rem;">
              üõçÔ∏è
            </div>
            {% endif %}
            <div>
              <div style="font-weight: 600;">{{ item.product.name }}</div>
              <div style="font-size: 0.85rem; color: var(--text-muted);">Qty: {{ item.quantity }}</div>
            </div>
          </div>
          <div style="font-weight: 600;">‚Çπ{{ item.price }}</div>
        </div>
        {% endfor %}

        <!-- Shipping & Actions -->
        <div
          style="margin-top: 1rem; display: flex; justify-content: space-between; align-items: center; font-size: 0.9rem;">
          <div style="color: var(--text-muted);">
            <strong>Shipping to:</strong> {{ order.full_name }}<br>
            {{ order.address }}, {{ order.city }} - {{ order.postal_code }}
          </div>

          <form method="POST" action="{% url 'cancel_order' order.id %}"
            onsubmit="return confirm('Are you sure you want to cancel this order?');">
            {% csrf_token %}
            <button type="submit" class="btn btn-outline btn-sm"
              style="color: var(--danger); border-color: var(--danger);">
              Cancel Order
            </button>
          </form>
        </div>
      </div>

    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="card text-center py-5" style="max-width: 600px; margin: 0 auto;">
    <h3 style="margin-bottom: 1rem;">No orders yet</h3>
    <p style="color: var(--text-muted); margin-bottom: 2rem;">Looks like you haven't bought anything yet.</p>
    <a href="{% url 'home' %}" class="btn btn-primary">Start Shopping</a>
  </div>
  {% endif %}
</div>
{% endblock %}