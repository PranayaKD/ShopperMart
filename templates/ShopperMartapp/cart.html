{% extends "base.html" %}
{% block title %}Your Cart | ShopperMart{% endblock %}

{% block content %}
<div class="container py-4">
  <h1 style="font-size: 2rem; font-weight: 800; margin-bottom: 2rem;">ðŸ›’ Shopping Cart</h1>

  {% if cart_items %}
  <div class="grid grid-3" style="grid-template-columns: 2fr 1fr; align-items: start; gap: 2rem;">

    <!-- Cart Items List -->
    <div style="display: flex; flex-direction: column; gap: 1rem;">
      {% for item in cart_items %}
      <div class="card"
        style="display: grid; grid-template-columns: 80px 1fr auto; gap: 1rem; align-items: center; padding: 1rem;">
        <!-- Image -->
        {% if item.product.image %}
        <img src="{{ item.product.image.url }}" class="rounded"
          style="width: 80px; height: 80px; object-fit: cover; border-radius: var(--radius-sm);" />
        {% else %}
        <div style="width: 80px; height: 80px; background: var(--surface-3); border-radius: var(--radius-sm);"></div>
        {% endif %}

        <!-- Details -->
        <div>
          <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 0.25rem;">{{ item.product.name }}</h3>
          <p style="color: var(--text-muted); font-size: 0.9rem;">Price: â‚¹{{ item.product.price }}</p>

          <!-- Mobile Actions Row -->
          <div style="margin-top: 0.5rem; display: flex; align-items: center; gap: 1rem;">
            <form action="{% url 'update_cart' item.id %}" method="post" style="display: flex; gap: 0.5rem;">
              {% csrf_token %}
              <input type="number" name="quantity" value="{{ item.quantity }}" min="1" class="form-control"
                style="width: 60px; padding: 0.25rem 0.5rem;">
              <button type="submit" class="btn btn-outline btn-sm">Update</button>
            </form>
            <a href="{% url 'remove_from_cart' item.id %}"
              style="color: var(--danger); font-size: 0.9rem; text-decoration: underline;">Remove</a>
          </div>
        </div>

        <!-- Total Price -->
        <div style="text-align: right; align-self: start;">
          <span style="font-weight: 700; font-size: 1.1rem;">â‚¹{{ item.subtotal }}</span>
        </div>
      </div>
      {% endfor %}
    </div>

    <!-- Summary Panel -->
    <div class="card" style="position: sticky; top: 100px;">
      <h3 style="margin-bottom: 1.5rem;">Order Summary</h3>
      <div style="display: flex; justify-content: space-between; margin-bottom: 1rem; font-size: 1.1rem;">
        <span>Total</span>
        <span style="font-weight: 700;">â‚¹{{ total }}</span>
      </div>
      <a href="{% url 'checkout' %}" class="btn btn-primary w-100 mb-3" style="text-align: center; display: block;">
        Proceed to Checkout
      </a>
      <a href="{% url 'home' %}"
        style="display: block; text-align: center; color: var(--text-muted); font-size: 0.9rem;">
        &larr; Continue Shopping
      </a>
    </div>

  </div>

  {% else %}
  <div class="card text-center py-5">
    <div style="font-size: 4rem; margin-bottom: 1rem;">ðŸ›’</div>
    <h3 style="margin-bottom: 1rem;">Your cart is empty</h3>
    <a href="{% url 'home' %}" class="btn btn-primary">Start Shopping</a>
  </div>
  {% endif %}
</div>

<!-- Responsive Adjustments -->
<style>
  @media (max-width: 768px) {
    .grid-3 {
      grid-template-columns: 1fr !important;
    }

    .card {
      grid-template-columns: 60px 1fr !important;
    }

    /* Stack logic better for mobile if needed */
  }
</style>
{% endblock %}